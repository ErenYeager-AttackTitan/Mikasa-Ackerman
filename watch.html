<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Watch Match - FanCode</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <script src="https://cdn.jwplayer.com/libraries/aVr2lJgW.js"></script>
  <style>
    body { background:#0f172a; color:#fff; font-family:'Segoe UI', sans-serif; }
    a.back { color:#f43f5e; text-decoration:underline; }
  </style>
</head>
<body class="p-4">
  <a href="index.html" class="back">&larr; Back</a>
  <div id="out" class="mt-6 max-w-3xl mx-auto"></div>

  <script>
    const id = new URLSearchParams(location.search).get('id');
    const API = "https://raw.githubusercontent.com/Jitendraunatti/fancode/refs/heads/main/data/fancode.json";
    document.getElementById('out').innerHTML = '<p>Loading match...</p>';

    async function load(){
      if(!id){return out.innerHTML='<p class="text-red-500">No ID provided</p>';}
      const m = (await (await fetch(API)).json()).matches.find(x=>x.match_id==id);
      if(!m) return out.innerHTML='<p class="text-red-500">Match not found</p>';

      const isLive = m.status==='STARTED';
      const isUpcoming = m.status==='NOT_STARTED';
      const isFinished = m.status==='COMPLETED';
      const status = isLive?'Live':isUpcoming?'Upcoming':'Finished';

      out.innerHTML = `
        <div class="bg-gray-800 p-4 rounded shadow text-center">
          <h2 class="text-3xl font-bold mb-2">${m.title}</h2>
          <p class="text-gray-400 mb-1">${m.tournament}</p>
          <p class="text-gray-500 mb-2">${m.startTime}</p>
          <p class="mb-3"><span class="badge ${isLive?'bg-success':isUpcoming?'bg-info':'bg-secondary'}">${status}</span></p>
          <img src="${m.image}" class="rounded mb-4 w-full h-60 object-cover">

          ${isLive && m.STREAMING_CDN?.Primary_Playback_URL ?
            `<div id="player" class="rounded shadow-md mb-4"></div>
             <script>
               jwplayer('player').setup({
                 file: '${m.STREAMING_CDN.Primary_Playback_URL}',
                 width:'100%', aspectratio:'16:9', autostart:true, controls:true
               });
             </script>`
          : `<p class="text-red-400">Stream ${isUpcoming?'not started yet':'unavailable'}</p>`}
        </div>`;
    }

    load();
  </script>
</body>
</html>
