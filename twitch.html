<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Twitch Player</title>
  <script src="https://cdn.jwplayer.com/libraries/aVr2lJgW.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }
    #player {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="player">Loading...</div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
      document.getElementById("player").innerText = "Error: No Twitch ID provided!";
    } else {
      fetch(`https://pwn.sh/tools/streamapi.py?url=twitch.tv/${id}`)
        .then(res => res.json())
        .then(data => {
          if (!data.success || !data.urls) {
            document.getElementById("player").innerText = "Stream not available!";
            return;
          }

          // Prioritized quality order
          const qualityOrder = ["1080p60", "720p60", "480p", "360p", "160p", "audio_only"];
          let chosenQuality = null;

          for (let quality of qualityOrder) {
            if (data.urls[quality]) {
              chosenQuality = quality;
              break;
            }
          }

          if (!chosenQuality) {
            document.getElementById("player").innerText = "No playable stream found!";
            return;
          }

          jwplayer("player").setup({
            file: data.urls[chosenQuality],
            width: "100%",
            height: "100%",
            type: "hls",
            title: `${id}'s Twitch Stream (${chosenQuality})`,
            autostart: true,
            controls: true
          });
        })
        .catch(err => {
          document.getElementById("player").innerText = "Error loading stream.";
          console.error(err);
        });
    }
  </script>
</body>
</html>
