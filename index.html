<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FanCode Matches Dashboard</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Tailwind CSS (via CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #111827; color: #F8FAFC; }
    .card { background: #1F2937; }
    input, select { background: #374151 !important; color: #F8FAFC !important; }
    .section-title { margin: 2rem 0 1rem; font-size: 1.5rem; }
  </style>
  <!-- JWPlayer Setup -->
  <script src="https://cdn.jwplayer.com/libraries/aVr2lJgW.js"></script>
</head>
<body class="p-4">

  <div class="container">
    <h1 class="mb-4 text-center text-3xl font-bold">ðŸ”´ FanCode Matches Dashboard</h1>

    <div class="row g-2 mb-4">
      <div class="col-sm-8">
        <input type="search" id="searchInput" class="form-control" placeholder="Search title, tournament, team..." />
      </div>
      <div class="col-sm-4">
        <select id="groupFilter" class="form-select">
          <option value="all">All Categories</option>
          <option value="cricket">Cricket</option>
          <option value="others">Others</option>
        </select>
      </div>
    </div>

    <div id="liveSection">
      <h2 class="section-title">Live Matches</h2>
      <div id="liveMatches" class="row row-cols-1 row-cols-md-3 g-4"></div>
    </div>

    <div id="finishedSection">
      <h2 class="section-title">Finished Matches</h2>
      <div id="finishedMatches" class="row row-cols-1 row-cols-md-3 g-4"></div>
    </div>

    <div id="upcomingSection">
      <h2 class="section-title">Upcoming Matches</h2>
      <div id="upcomingMatches" class="row row-cols-1 row-cols-md-3 g-4"></div>
    </div>
  </div>

  <script>
    const apiUrl = "https://raw.githubusercontent.com/Jitendraunatti/fancode/refs/heads/main/data/fancode.json";
    let allMatches = [];

    async function loadMatches() {
      try {
        const res = await fetch(apiUrl);
        const { matches } = await res.json();
        allMatches = matches;
        applyFilters();
      } catch (e) {
        console.error(e);
      }
    }

    function getCategory(m) {
      return m.tournament.toLowerCase().includes("cricket") ? "cricket" : "others";
    }

    function applyFilters() {
      const q = document.getElementById("searchInput").value.toLowerCase();
      const grp = document.getElementById("groupFilter").value;

      const filtered = allMatches.filter(m => (
        (m.title + m.tournament + m.teams.map(t => t.name).join(" "))
        .toLowerCase().includes(q)
      ) && (grp === "all" || getCategory(m) === grp));

      renderByStatus(filtered);
    }

    function renderByStatus(list) {
      const sections = {
        STARTED: document.getElementById("liveMatches"),
        COMPLETED: document.getElementById("finishedMatches"),
        NOT_STARTED: document.getElementById("upcomingMatches")
      };
      Object.values(sections).forEach(c => c.innerHTML = "");

      list.forEach(m => {
        const card = document.createElement("div");
        card.className = "col";
        card.innerHTML = `
          <div class="card h-100">
            <img src="${m.image}" class="card-img-top" alt="${m.title}">
            <div class="card-body">
              <h5 class="card-title">${m.title}</h5>
              <p class="card-text">${m.teams.map(t => t.name).join(" vs ")}</p>
              <p class="text-sm text-gray-400">${m.startTime}</p>
            </div>
            <div class="card-footer bg-gray-700">
              ${m.status === "STARTED" && m.STREAMING_CDN?.Primary_Playback_URL ? 
                `<button class="btn btn-primary w-100" onclick="playStream('${m.STREAMING_CDN.Primary_Playback_URL}',${m.match_id})">Watch</button>` :
                `<span class="text-gray-400">${m.status === "STARTED" ? "Waiting for streamâ€¦" : m.status === "COMPLETED" ? "Finished" : "Upcoming"}</span>`
              }
            </div>
          </div>`;
        sections[m.status].appendChild(card);
      });
    }

    function playStream(url, id) {
      const modal = document.createElement('div');
      modal.innerHTML = `
        <div class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50">
          <div class="bg-gray-800 rounded-lg overflow-hidden w-11/12 max-w-xl">
            <div id="jwplayer-${id}" style="height:300px;"></div>
            <button class="btn btn-danger m-3" onclick="this.closest('div.fixed').remove()">Close</button>
          </div>
        </div>`;
      document.body.appendChild(modal);
      jwplayer(`jwplayer-${id}`).setup({ file: url, width: "100%", aspectratio: "16:9" });
    }

    document.getElementById("searchInput").addEventListener("input", applyFilters);
    document.getElementById("groupFilter").addEventListener("change", applyFilters);

    loadMatches();
    setInterval(loadMatches, 60000);
  </script>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
