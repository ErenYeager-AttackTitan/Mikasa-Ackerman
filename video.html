<!DOCTYPE html>
<html lang="en" class="bg-gray-900 text-white">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Watch Video</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4">
  <div class="max-w-5xl mx-auto space-y-6">
    <h1 id="title" class="text-2xl font-bold text-center"></h1>

    <div id="iframeContainer" class="w-full aspect-w-16 aspect-h-9 bg-black rounded-xl overflow-hidden shadow-lg">
      <!-- iframe will be injected here -->
    </div>

    <p id="error" class="text-center text-red-500 hidden">Video not found</p>
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get("id");
    const titleEl = document.getElementById("title");
    const iframeContainer = document.getElementById("iframeContainer");
    const errorEl = document.getElementById("error");

    if (!id) {
      errorEl.textContent = "No ID provided.";
      errorEl.classList.remove("hidden");
    } else {
      fetch("https://crew-auth.vercel.app/videos")
        .then(res => res.json())
        .then(videos => {
          const video = videos.find(v => v._id === id);
          if (!video) {
            errorEl.textContent = "Video not found.";
            errorEl.classList.remove("hidden");
            return;
          }

          titleEl.textContent = video.title;

          let iframeURL = "";
          if (video.xhamster && video.xh) {
            iframeURL = `https://ackerman-mikasa.pages.dev/xhm?id=${encodeURIComponent(video.xh)}`;
          } else if (video.xvideo && video.xv) {
            iframeURL = `https://ackerman-mikasa.pages.dev/embed?id=${encodeURIComponent(video.xv)}`;
          }

          if (iframeURL) {
            const iframe = document.createElement("iframe");
            iframe.src = iframeURL;
            iframe.className = "w-full h-full";
            iframe.setAttribute("allowfullscreen", "true");
            iframe.setAttribute("frameborder", "0");
            iframeContainer.appendChild(iframe);
          } else {
            errorEl.textContent = "Unsupported video type.";
            errorEl.classList.remove("hidden");
          }
        })
        .catch(err => {
          errorEl.textContent = "Error loading video.";
          errorEl.classList.remove("hidden");
        });
    }
  </script>
</body>
</html>
